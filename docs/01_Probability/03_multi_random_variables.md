# 第二章：随机变量及其分布 (Random Variables & Distributions)

## 前言：为什么要引入随机变量？

在第一章中，我们处理的样本空间 $\Omega$ 往往是具体的、非数值的。比如：
* 扔硬币：$\Omega = \{ \text{Head}, \text{Tail} \}$
* 抽扑克：$\Omega = \{ \heartsuit, \spadesuit, \clubsuit, \diamondsuit \}$
* 检验产品：$\Omega = \{ \text{合格}, \text{次品} \}$

虽然我们可以计算这些事件的概率，但无法进行更高级的数学运算。我们没法计算“$\text{Head} + \text{Tail}$”是多少，也没法对“$\heartsuit$”求导数。

为了使用微积分、线性代数等强大的数学工具，我们需要建立一座桥梁，将抽象的样本点映射为实数。**随机变量 (Random Variable)** 就是这座桥梁。它让我们从研究“事件”转变为研究“函数”和“分布”。

本章我们将重点讨论**一维随机变量**及其分布规律。


## 2.1 随机变量的基本概念

### 2.1.1 随机变量的定义 (Definition of Random Variables)

**1. 什么是随机变量？**
直观地说，随机变量就是一个“翻译官”。它把随机试验的每一个结果（样本点）都翻译成一个唯一的实数。

* **文字描述**：随机变量是定义在样本空间 $\Omega$ 上，取值于实数集 $\mathbb{R}$ 的一个函数。
* **符号描述**：设 $(\Omega, \mathcal{F}, P)$ 是一个概率空间。随机变量 $X$ 是一个映射：
    $$X: \Omega \to \mathbb{R}$$
    对于每一个样本点 $\omega \in \Omega$，都有唯一的实数 $X(\omega)$ 与之对应。

> **⚠️ 考点：可测性 (Measurability)**
> 并不是任意一个函数都能叫随机变量。在测度论中，随机变量必须是 **$\mathcal{F}$-可测函数**。
> **定义**：对于实数轴上的任意博雷尔集 (Borel Set) $B \in \mathcal{B}(\mathbb{R})$，其原像必须属于事件域 $\mathcal{F}$：
> $$X^{-1}(B) = \{ \omega \in \Omega : X(\omega) \in B \} \in \mathcal{F}$$
> *解释*：这意味着我们关心的数值范围（比如 $X > 5$），必须对应一个我们**能算出概率的合法事件**。如果 $X$ 映射出的结果对应的原事件不在 $\mathcal{F}$ 里，那概率 $P(X>5)$ 就无法定义，$X$ 也就不是随机变量。

**2. 常见的随机变量**
* **扔硬币**：
    * $\Omega = \{ \text{正面 (H)}, \text{反面 (T)} \}$
    * 定义 $X$：$X(H) = 1, X(T) = 0$。
    * 此时 $P(X=1) = P(\{H\}) = 0.5$。
* **掷骰子**：
    * $\Omega = \{ \omega_1, \omega_2, \dots, \omega_6 \}$，其中 $\omega_i$ 表示点数为 $i$ 的面。
    * 定义 $X$：$X(\omega_i) = i$。
    * 事件“点数大于 4”可以表示为 $X > 4$，对应原事件 $\{ \omega_5, \omega_6 \}$。

**3. 随机变量的分类**
根据取值情况的不同，随机变量主要分为两类（在高等概率论中还有第三类）：

1.  **离散型 (Discrete RV)**：
    * 取值是有限个或可列无限个（如 $0, 1, 2, \dots$）。
    * *例子*：二项分布、泊松分布、几何分布。
2.  **连续型 (Continuous RV)**：
    * 取值充满整个区间（如 $[0, 1]$ 或 $(-\infty, +\infty)$），且任意单点的概率为 0。
    * *例子*：正态分布、指数分布、均匀分布。
3.  **混合型/奇异型 (Mixed/Singular RV)**：
    * 既不是纯离散也不是纯连续，或者存在奇异部分（如康托尔分布）。
    * *例子*：带跳跃的资产价格模型（Jump-Diffusion Model）。


### 2.1.2 随机变量的分布函数 (Cumulative Distribution Function, CDF)

对于任何随机变量（无论是离散还是连续），我们都需要一个统一的工具来描述它的概率规律。这个工具就是**分布函数**。

**1. 定义与概念**
设 $X$ 是一个随机变量，$x$ 是任意实数。函数
$$F(x) = P(X \le x) = P(\{ \omega \in \Omega : X(\omega) \le x \})$$
称为 $X$ 的**累积分布函数** (Cumulative Distribution Function)，简称 **CDF** 或分布函数。

* **几何意义**：$F(x)$ 描述了概率在实数轴上从左到右的“累积”过程。它是概率质量的扫描仪。

**2. 表现形式**
* **离散型**：呈阶梯状（Step Function）。在可能取值点处发生跳跃，跳跃高度等于该点的概率。
* **连续型**：呈连续曲线状。光滑平缓，没有跳跃。

**3. 重要性质 (Properties) —— 笔试必考**
一个函数 $F(x)$ 要成为合法的分布函数，必须满足以下三条性质：

1.  **单调非减性 (Monotonically Non-decreasing)**：
    若 $x_1 < x_2$，则 $F(x_1) \le F(x_2)$。
    * *解释*：随着 $x$ 增大，包含的范围越来越大，累积的概率自然只增不减。

2.  **规范性 (Normalization / Boundedness)**：
    $$\lim_{x \to -\infty} F(x) = 0, \quad \lim_{x \to +\infty} F(x) = 1$$
    * *解释*：不可能有数值比 $-\infty$ 还小，所有数值一定都比 $+\infty$ 小。

3.  **右连续性 (Right Continuity)**：
    $$\lim_{x \to x^+} F(x) = F(x)$$
    * *解释*：这取决于定义中的“小于等于 ($\le$)”。
    * *反例*：如果我们定义 $F(x) = P(X < x)$，那它就是左连续的。但在主流数学体系（包括柯尔莫哥洛夫体系）中，标准定义是右连续。
  
**4. 公式与概率的对应关系**
通过 CDF，我们可以计算任意区间的概率：
* $P(a < X \le b) = F(b) - F(a)$
* $P(X > a) = 1 - F(a)$
* $P(X = a) = F(a) - F(a^-)$ （即 $a$ 处的跳跃高度）
    * *注*：对于连续型随机变量，没有跳跃，所以 $P(X=a) = 0$。

## 2.2 随机变量的类型与常见分布

在量化研究中，我们遇到的变量主要分为两类：一类是跳跃的（比如每天的交易次数、涨跌停家数），对应离散型；另一类是连续波动的（比如股价收益率、期权隐含波动率），对应连续型。

### 2.2.1 离散型随机变量及其分布律 (Discrete RVs)

**1. 分布律 (Probability Mass Function, PMF)**
对于离散型随机变量 $X$，它所有可能的取值为 $x_1, x_2, \dots$。我们需要知道取每一个值的概率是多少。
定义分布律为：
$$P(X=x_k) = p_k, \quad k=1, 2, \dots$$

* **表现形式**：
    * **表格法**：最直观，考试常考。
        | $X$ | $x_1$ | $x_2$ | $\dots$ | $x_n$ |
        | :--- | :--- | :--- | :--- | :--- |
        | $P$ | $p_1$ | $p_2$ | $\dots$ | $p_n$ |
    * **矩阵/向量法**：在 Python 编程中，我们通常用向量 `[p1, p2, ...]` 来表示。

* **基本性质 (必背)**：
    1.  **非负性**：$p_k \ge 0$。
    2.  **规范性**：$\sum_{k=1}^{\infty} p_k = 1$。

**2. 常见离散分布**

**(1) 0-1 分布 (Bernoulli Distribution)**
* **定义**：试验只有两个结果（成功/失败）。记为 $X \sim B(1, p)$。
* **分布律**：$P(X=1)=p, \quad P(X=0)=1-p$。
* **量化含义**：单次交易是盈利还是亏损；期权是否行权。

**(2) 二项分布 (Binomial Distribution)**
* **定义**：$n$ 重伯努利试验中成功的次数。记为 $X \sim B(n, p)$。
* **分布律**：
    $$P(X=k) = C_n^k p^k (1-p)^{n-k}, \quad k=0, 1, \dots, n$$
* **性质**：$E[X] = np, \quad Var(X) = np(1-p)$。
* **量化含义**：假设策略胜率为 55%，做 100 次交易，盈利次数的分布。

**(3) 泊松分布 (Poisson Distribution)**
这是金融工程中极其重要的分布，用于描述**“稀有事件”**。
* **定义**：记为 $X \sim P(\lambda)$ 或 $\pi(\lambda)$。
* **分布律**：
    $$P(X=k) = \frac{\lambda^k}{k!} e^{-\lambda}, \quad k=0, 1, 2, \dots$$
* **参数含义**：$\lambda$ 代表单位时间内事件发生的**平均次数**（强度）。
* **泊松定理 (Poisson Limit Theorem)**：
    当 $n \to \infty, p \to 0$ 且 $np = \lambda$ 保持不变时，二项分布收敛于泊松分布：
    $$\lim_{n \to \infty} C_n^k p^k (1-p)^{n-k} = \frac{\lambda^k}{k!} e^{-\lambda}$$
    * *直觉*：如果你每秒钟都在做高频交易（$n$ 很大），但每次成交概率很低（$p$ 很小），那么你一分钟内的成交次数就服从泊松分布。
* **跳跃过程**：在 Merton 跳跃扩散模型 (Jump Diffusion) 中，资产价格发生跳跃的次数通常假设服从泊松分布。

**(4) 超几何分布 (Hypergeometric Distribution)**
* **定义**：$N$ 件产品中有 $M$ 件次品，**不放回**地抽取 $n$ 件，其中次品数 $X$ 的分布。记为 $X \sim H(n, M, N)$。
* **分布律**：
    $$P(X=k) = \frac{C_M^k C_{N-M}^{n-k}}{C_N^n}$$
* **区别**：如果是有放回抽样，就是二项分布。当总体 $N$ 很大时，超几何分布近似于二项分布（因为拿走一个对总体影响微乎其微）。


### 2.2.2 连续型随机变量及其概率密度函数 (Continuous RVs)

**1. 概率密度函数 (PDF)**
对于连续型变量，单点概率 $P(X=x)=0$，所以我们要讨论“概率的密度”。
如果存在非负函数 $f(x)$，使得对于任意区间 $[a, b]$：
$$P(a < X \le b) = \int_a^b f(x) dx$$
则称 $X$ 为连续型随机变量，$f(x)$ 为**概率密度函数**。

* **分布函数与 PDF 的关系**：
    $$F(x) = \int_{-\infty}^x f(t) dt, \quad f(x) = F'(x)$$
* **几何意义**：
    * $f(x)$ 是曲线的高度。
    * 概率 $P$ 是曲线下方的**面积**。
    * $F(x)$ 是从左无穷远积分别到 $x$ 的累积面积。
* **基本性质 (必背)**：
    1.  $f(x) \ge 0$ （注意：$f(x)$ 可以大于 1，只要积分是 1 即可）。
    2.  $\int_{-\infty}^{+\infty} f(x) dx = 1$ （总面积为 1）。

**2. 常见连续分布**

**(1) 均匀分布 (Uniform Distribution)**
* **定义**：在区间 $[a, b]$ 上“等可能”出现。记为 $X \sim U(a, b)$。
* **PDF**：
    $$f(x) = \begin{cases} \frac{1}{b-a}, & a < x < b \\ 0, & \text{其他} \end{cases}$$
* **量化含义**：
    * 这是蒙特卡洛模拟 (Monte Carlo) 的基石。计算机生成的随机数 `rand()` 本质上就是 $U(0, 1)$。
    * 在贝叶斯统计中，如果我们对参数一无所知，通常假设先验分布为均匀分布（无信息的先验）。

**(2) 指数分布 (Exponential Distribution)**
* **定义**：常用于描述“寿命”或“等待时间”。记为 $X \sim E(\lambda)$。
* **PDF**：
    $$f(x) = \begin{cases} \lambda e^{-\lambda x}, & x > 0 \\ 0, & x \le 0 \end{cases}$$
* **重要性质：无记忆性 (Memorylessness)**
    $$P(X > s+t | X > s) = P(X > t)$$
    * *解释*：如果一个灯泡已经亮了 $s$ 小时没坏，它再亮 $t$ 小时的概率，和它是一个新灯泡时能亮 $t$ 小时的概率是一样的。它“忘记”了自己已经工作了多久。
* **与泊松分布的关系 (高频考点)**：
    如果某事件发生的次数服从参数为 $\lambda$ 的泊松分布（泊松流），那么**相邻两次事件发生的时间间隔**服从参数为 $\lambda$ 的指数分布。
    * *泊松分布*：数数（离散）。
    * *指数分布*：量时间（连续）。

**(3) 正态分布 (Normal / Gaussian Distribution)**
这是概率论的“皇帝”，中心极限定理 (CLT) 的归宿。
* **定义**：记为 $X \sim N(\mu, \sigma^2)$。
* **PDF (必须能默写)**：
    $$f(x) = \frac{1}{\sqrt{2\pi}\sigma} e^{-\frac{(x-\mu)^2}{2\sigma^2}}, \quad -\infty < x < +\infty$$
* **参数**：$\mu$ 决定位置（对称轴），$\sigma$ 决定形状（胖瘦）。
* **标准正态分布 $N(0, 1)$**：
    令 $Z = \frac{X-\mu}{\sigma}$，则 $Z \sim N(0, 1)$。其 PDF 记为 $\phi(x)$，CDF 记为 $\Phi(x)$。
* **3$\sigma$ 原则**：
    * $P(|X-\mu| < \sigma) \approx 68.26\%$
    * $P(|X-\mu| < 2\sigma) \approx 95.44\%$
    * $P(|X-\mu| < 3\sigma) \approx 99.73\%$
    * *量化应用*：在布林带 (Bollinger Bands) 策略中，我们通常把上下轨设为 2 倍标准差，意味着股价有 95% 的概率在这个通道内运行。突破通道通常意味着异常或趋势反转。

## 2.3 随机变量的数字特征

如果说分布函数 $F(x)$ 是随机变量的“全身照”，那么数字特征就是它的“体检报告”。在量化交易中，我们往往不需要知道股价每一秒的分布细节，只需要抓住**期望（预期收益）**和**方差（风险）**这两个核心指标，就足以构建马科维茨（Markowitz）投资组合模型了。

### 2.3.1 数学期望 (Mathematical Expectation)

#### 1. 概念起源：分赌本问题
期望的概念最早源于帕斯卡和费马对“分赌本问题”的讨论。
* **场景**：甲乙两人赌硬币，先赢 3 局者拿走全部 100 元。当前甲赢了 2 局，乙赢了 1 局，赌局因故中断。钱该怎么分？
* **直觉**：甲赢面大，应该多拿。
* **期望解法**：如果继续赌，甲赢的概率是 $0.5 + 0.5 \times 0.5 = 0.75$（下一局直接赢，或下一局输但下下局赢）。乙赢的概率是 $0.25$。
* **结论**：公平的分配方式不是看“现在谁赢得多”，而是看“未来预期的潜在收益”。甲应得 $100 \times 0.75 = 75$ 元。这就是**数学期望**的雏形——**对未来的加权预测**。

#### 2. 定义与物理意义
* **定义**：
    * **离散型**：$E[X] = \sum_{k} x_k p_k$（要求级数绝对收敛）。
    * **连续型**：$E[X] = \int_{-\infty}^{+\infty} x f(x) dx$（要求积分绝对收敛）。
    
    > **💡 测度论视角 (Lebesgue Integral)**
    > 在高等概率论中，期望本质上是随机变量 $X$ 关于概率测度 $P$ 的**勒贝格积分**：
    > $$E[X] = \int_{\Omega} X(\omega) dP(\omega)$$
    > 这种定义方式统一了离散和连续，并且能够处理更复杂的“混合分布”（比如带有跳跃的资产价格）。

* **物理意义**：期望是随机变量分布的**“重心”**。如果你把概率密度看作质量分布，支撑点就在 $E[X]$ 处。

* **现实案例**：
    * **彩票**：一张 2 元的彩票，中奖概率极低，计算下来的数学期望通常只有 0.8 元左右。这意味着长期买彩票的人，每买一张就在亏损 1.2 元（智商税）。
    * **交易系统**：一个胜率 40% 的策略，如果盈亏比是 3:1，那么它的单笔期望收益是正的（$0.4 \times 3 - 0.6 \times 1 = 0.6$）。**做交易是做期望，而不是做胜率。**

#### 3. 重要性质
1.  **线性性 (Linearity)**：$E[aX + bY + c] = aE[X] + bE[Y] + c$。
    * *注意*：**不需要** $X$ 和 $Y$ 独立。这是构建投资组合理论的基石——组合的预期收益等于各资产预期收益的加权平均。
2.  **随机变量函数的期望 (LOTUS)**：
    求 $Y = g(X)$ 的期望，**不需要**先求出 $Y$ 的分布 $f_Y(y)$，直接用 $X$ 的分布算：
    $$E[g(X)] = \int_{-\infty}^{+\infty} g(x) f(x) dx$$
    这被称为**无意识统计学家定律 (Law of the Unconscious Statistician)**。



### 2.3.2 方差与标准差 (Variance & Standard Deviation)

#### 1. 定义与公式
* **定义**：方差衡量随机变量偏离其中心的程度。
    $$Var(X) = E[(X - E[X])^2]$$
* **计算公式**：实际计算中常用：
    $$Var(X) = E[X^2] - (E[X])^2$$
* **标准差**：$\sigma = \sqrt{Var(X)}$。在金融中，它直接对应**波动率 (Volatility)**。

#### 2. 物理与现实意义
* **物理意义**：转动惯量。分布越分散，转动惯量越大。
* **现实案例**：银行理财产品的风险等级（R1-R5），本质上就是根据其历史收益率的标准差来划分的。标准差越大，可能亏损的幅度也越大。

#### 3. 重要性质
1.  **平移不变性**：$Var(X + c) = Var(X)$。加一个常数不改变波动。
2.  **缩放性**：$Var(cX) = c^2 Var(X)$。杠杆加倍，方差变成 4 倍。
3.  **和的方差**：
    $$Var(X \pm Y) = Var(X) + Var(Y) \pm 2Cov(X, Y)$$
    * *特别注意*：只有当 $X, Y$ **不相关**（即 $Cov=0$）时，才有 $Var(X+Y) = Var(X) + Var(Y)$。这是分散化投资能降低风险的数学原理。

#### 4. 切比雪夫不等式 (Chebyshev's Inequality)
这是一个不需要知道具体分布就能估算尾部风险的神器。

* **定理**：对于任意随机变量 $X$ (只要方差存在)，对于任意 $\epsilon > 0$：
    $$P(|X - \mu| \ge \epsilon) \le \frac{\sigma^2}{\epsilon^2}$$
* **证明思路 (Proof Sketch)**：
    利用马尔可夫不等式或直接放大积分区域。
    $$
    \sigma^2 = \int_{-\infty}^{+\infty} (x-\mu)^2 f(x) dx \ge \int_{|x-\mu| \ge \epsilon} (x-\mu)^2 f(x) dx
    $$
    在积分区域 $|x-\mu| \ge \epsilon$ 内，$(x-\mu)^2 \ge \epsilon^2$，所以：
    $$
    \sigma^2 \ge \epsilon^2 \int_{|x-\mu| \ge \epsilon} f(x) dx = \epsilon^2 P(|X-\mu| \ge \epsilon)
    $$
    移项即得证。
* **意义**：哪怕不知道黑天鹅长什么样，只要知道波动率，就能给极端风险画一条“上限线”。



### 2.3.3 协方差、相关系数与矩

#### 1. 协方差 (Covariance)
* **定义**：衡量两个变量“同向变动”的程度。
    $$Cov(X, Y) = E[(X-\mu_x)(Y-\mu_y)] = E[XY] - E[X]E[Y]$$
* **协方差矩阵**：对于 $n$ 维随机变量 $\mathbf{X} = (X_1, \dots, X_n)^T$，其协方差矩阵 $\Sigma$ 是一个对称半正定矩阵，第 $(i, j)$ 个元素是 $Cov(X_i, X_j)$。

#### 2. 相关系数 (Correlation Coefficient)
* **定义**：标准化的协方差，消除了量纲影响。
    $$\rho_{XY} = \frac{Cov(X, Y)}{\sqrt{Var(X)}\sqrt{Var(Y)}}$$
* **性质定理**：$|\rho_{XY}| \le 1$。
    * **证明 (柯西-施瓦茨不等式的概率版)**：
        构造一个关于 $t$ 的二次函数：
        $$g(t) = E[(t(X-\mu_x) + (Y-\mu_y))^2] \ge 0$$
        展开后得到一个关于 $t$ 的一元二次方程 $At^2 + Bt + C \ge 0$。
        因为恒非负，所以判别式 $\Delta = B^2 - 4AC \le 0$。
        代入系数即可推出 $(Cov)^2 \le Var(X)Var(Y)$，开方即得 $|\rho| \le 1$。 $\blacksquare$

#### 3. 矩 (Moments)
* **原点矩**：$E[X^k]$。一阶原点矩就是期望。
* **中心矩**：$E[(X-\mu)^k]$。二阶中心矩就是方差。

---

### 2.3.4 其他特征：偏度、峰度与分位数

金融市场是非正态的，主要体现在**偏**和**尖**。

1.  **偏度 (Skewness)**：三阶标准化中心矩。
    * $S < 0$（左偏）：长尾在左边。**金融资产收益率通常是左偏的**（涨得慢，跌得快/深）。
2.  **峰度 (Kurtosis)**：四阶标准化中心矩。
    * $K > 3$（尖峰肥尾）：极端值出现的概率比正态分布大得多。这是**黑天鹅**的数学栖息地。
3.  **变异系数 (CV)**：$CV = \sigma / \mu$。衡量单位收益的风险，用于比较量纲不同的资产。
4.  **分位数 (Quantile)**：$x_\alpha$ 满足 $P(X \le x_\alpha) = \alpha$。
    * **中位数**：$\alpha = 0.5$。
    * **VaR (Value at Risk)**：风险价值本质上就是收益率分布的 $\alpha$ 分位数（如 5% 分位点）。

---

### 2.3.5 常见随机变量的期望与方差汇总

这是一张必须印在脑子里的表：

| 分布 | 记号 | 期望 $E[X]$ | 方差 $Var(X)$ | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| **0-1分布** | $B(1, p)$ | $p$ | $p(1-p)$ | 伯努利试验基础 |
| **二项分布** | $B(n, p)$ | $np$ | $np(1-p)$ | $n$ 次独立伯努利 |
| **泊松分布** | $P(\lambda)$ | $\lambda$ | $\lambda$ | **期望等于方差** |
| **均匀分布** | $U(a, b)$ | $\frac{a+b}{2}$ | $\frac{(b-a)^2}{12}$ | 12这个分母常考 |
| **指数分布** | $E(\lambda)$ | $\frac{1}{\lambda}$ | $\frac{1}{\lambda^2}$ | 均值越小，衰减越快 |
| **正态分布** | $N(\mu, \sigma^2)$ | $\mu$ | $\sigma^2$ | 参数即特征 |
