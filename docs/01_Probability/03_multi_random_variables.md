# 第三章：多维随机变量及其分布

**前言：为什么要进入高维世界？**

在第一章和第二章中，我们研究的都是“独行侠”——单个随机变量（如单支股票的收益率）。但在现实的金融世界里，资产从来不是孤立存在的。
* **投资组合 (Portfolio)**：我们需要同时持有股票、债券、黄金。
* **配对交易 (Pair Trading)**：我们需要盯着两只相关性很高的股票的价差。
* **宏观分析**：我们需要分析通胀率、利率和汇率的联动。

为了描述这些变量之间“牵一发而动全身”的复杂关系（特别是**相关性**），我们需要把多个随机变量放在一起研究。这就是**随机向量**。

## 3.1 多维随机变量及其联合分布

### 3.1.1 多维随机变量 (Random Vectors)

**1. 定义：从标量到向量**

直观地说，如果我们在同一个样本空间 $\Omega$ 上定义了 $n$ 个随机变量 $X_1, X_2, \dots, X_n$，那么由它们组成的向量 $\mathbf{X} = (X_1, X_2, \dots, X_n)$ 就称为 **$n$ 维随机变量** 或 **随机向量**。

* **映射视角**：
    $\mathbf{X}$ 是一个从样本空间 $\Omega$ 到 $n$ 维欧几里得空间 $\mathbb{R}^n$ 的映射：
    $$\mathbf{X}: \Omega \to \mathbb{R}^n$$
    对于每一个样本点 $\omega \in \Omega$，都有一个向量值 $\mathbf{X}(\omega) = (X_1(\omega), \dots, X_n(\omega))$ 与之对应。

> **💡 测度论视角 (The Measure View)**
>
> 这里有一个博士入学考试常考的概念陷阱：**并不是任意把 n 个函数捆在一起就能叫随机向量。**
>
> $\mathbf{X}$ 必须是 **$\mathcal{F}$-可测的**。即对于 $\mathbb{R}^n$ 中的任意博雷尔集 (Borel Set) $B$，其原像必须属于事件域 $\mathcal{F}$：
> $$X^{-1}(B) = \{ \omega : \mathbf{X}(\omega) \in B \} \in \mathcal{F}$$
> * **直觉解释**：这保证了我们讨论诸如“股票A涨且股票B跌”（即向量落在某个象限）这类复杂事件的概率是合法的。如果在数学上无法测量（Unmeasurable），讨论概率就没有任何意义。

**2. 实际情况举例**

* **量化因子**：一个因子的多维度表现（动量、波动率、换手率）构成一个 3 维随机向量。
* **期权定价**：在 Heston 模型中，(标的资产价格 $S_t$, 随机波动率 $v_t$) 构成一个 2 维随机过程。



### 3.1.2 联合分布函数 (Joint CDF)

为了描述这些变量“同时”取值的概率规律，我们定义**联合累积分布函数**。

**1. 定义与表达式**

设 $(X, Y)$ 是二维随机变量。对于任意实数 $x, y$，二元函数：
$$F(x, y) = P(X \le x, Y \le y) = P(\{ \omega : X(\omega) \le x \} \cap \{ \omega : Y(\omega) \le y \})$$
称为 $(X, Y)$ 的**联合分布函数**。

* **几何意义**：在平面直角坐标系中，$F(x, y)$ 代表点 $(x, y)$ **左下方**无穷矩形区域内的概率质量。

**2. 相关定理与性质**

* **单调性**：$F(x, y)$ 对每个变量都是单调不减的。
* **有界性**：
    * $0 \le F(x, y) \le 1$
    * $F(-\infty, y) = F(x, -\infty) = 0$ （不可能事件）
    * $F(+\infty, +\infty) = 1$ （必然事件）
* **右连续性**：$F(x, y)$ 关于每个变量都是右连续的。
* **矩形概率公式（核心计算工具）**：
    
    要计算矩形区域 $D = \{ (u, v) : x_1 < u \le x_2, y_1 < v \le y_2 \}$ 的概率，我们使用类似于二维前缀和的**容斥原理**：
    $$P(x_1 < X \le x_2, y_1 < Y \le y_2) = F(x_2, y_2) - F(x_1, y_2) - F(x_2, y_1) + F(x_1, y_1)$$
    * *记忆口诀*：大矩形 - 上方条 - 左方条 + 重复减去的左下角。



### 3.1.3 联合分布列 (Joint PMF - Discrete Case)

如果 $X$ 和 $Y$ 都是离散型的（例如抛两枚硬币），我们就用**联合分布列**来描述。

**1. 定义**

$$p_{ij} = P(X = x_i, Y = y_j), \quad i,j = 1, 2, \dots$$

**2. 表现形式**

通常画成一个二维表格（矩阵）：

| $X \setminus Y$ | $y_1$ | $y_2$ | $\dots$ |
| :--- | :--- | :--- | :--- |
| **$x_1$** | $p_{11}$ | $p_{12}$ | $\dots$ |
| **$x_2$** | $p_{21}$ | $p_{22}$ | $\dots$ |
| **$\dots$** | $\dots$ | $\dots$ | $\dots$ |

**3. 性质**

* **非负性**：$p_{ij} \ge 0$
* **归一性**：$\sum_i \sum_j p_{ij} = 1$ （所有格子的概率加起来必须等于 1）。



### 3.1.4 联合密度函数 (Joint PDF - Continuous Case)

对于连续型变量（如股价），单点概率为 0，我们关注的是**概率密度**。

**1. 定义**

如果存在非负函数 $f(x, y)$，使得对于任意区域 $D$，概率可以表示为积分：
$$P((X, Y) \in D) = \iint_D f(x, y) \, dx \, dy$$
则称 $f(x, y)$ 为**联合概率密度函数**。

**2. 与分布函数的关系**

$$F(x, y) = \int_{-\infty}^x \int_{-\infty}^y f(u, v) \, du \, dv$$
$$f(x, y) = \frac{\partial^2 F}{\partial x \partial y} \quad (\text{在连续点处})$$

**3. 几何意义与性质**

* **几何意义**：$z = f(x, y)$ 是空间中的一个曲面（像一座山）。概率 $P$ 是以区域 $D$ 为底，曲面为顶的**柱体体积**。
* **归一性**：$\int_{-\infty}^{+\infty} \int_{-\infty}^{+\infty} f(x, y) \, dx \, dy = 1$ （总体积为 1）。


### 3.1.5 常用多维分布 (Common Multivariate Distributions)

**1. 多项分布 (Multinomial Distribution)**

* **概念**：二项分布的推广。每次试验不是只有“成功/失败”两种结果，而是有 $k$ 种可能（如：涨、跌、平）。
* **公式**：
    $$P(X_1=n_1, \dots, X_k=n_k) = \frac{n!}{n_1! n_2! \dots n_k!} p_1^{n_1} p_2^{n_2} \dots p_k^{n_k}$$
    其中 $\sum n_i = n, \sum p_i = 1$。

**2. 多维均匀分布 (Multivariate Uniform)**

* **概念**：概率密度在某个有界区域 $D$ 上是常数（平顶山）。
* **PDF**：
    $$f(x_1, \dots, x_n) = \begin{cases} \frac{1}{\text{Volume}(D)}, & (x_1, \dots, x_n) \in D \\ 0, & \text{其他} \end{cases}$$

**3. 二元正态分布 (Bivariate Normal Distribution) —— 核心考点**

这是现代投资组合理论 (MPT) 的基石。

* **表达式**：$(X, Y) \sim N(\mu_1, \mu_2, \sigma_1^2, \sigma_2^2, \rho)$。
* **五大参数**：
    * $\mu_1, \mu_2$：决定中心位置。
    * $\sigma_1, \sigma_2$：决定各自维度的波动幅度。
    * **$\rho$ (相关系数)**：$|\rho| < 1$，决定了两者线性关系的紧密程度。
* **联合 PDF**：
    $$f(x, y) = \frac{1}{2\pi \sigma_1 \sigma_2 \sqrt{1-\rho^2}} \exp \left\{ -\frac{1}{2(1-\rho^2)} \left[ \frac{(x-\mu_1)^2}{\sigma_1^2} - 2\rho \frac{(x-\mu_1)(y-\mu_2)}{\sigma_1 \sigma_2} + \frac{(y-\mu_2)^2}{\sigma_2^2} \right] \right\}$$
    * *注*：指数部分是一个**二次型 (Quadratic Form)**，它决定了等高线是椭圆。

## 3.2 边缘分布与随机变量的独立性

在上一节我们构建了宏大的联合分布 $F(x, y)$。但在实际工作中，我们经常面临两个具体问题：
1.  **降维**：我手头有一个由股票 A 和股票 B 组成的投资组合，但我现在只想单独研究股票 A 的风险（边缘分布）。
2.  **解耦**：这两只股票的涨跌到底有没有关系？如果股票 A 涨了，会影响股票 B 吗？（独立性）。

### 3.2.1 边缘分布函数 (Marginal CDF)

**1. 定义与直觉**
当我们有了联合分布函数 $F(x, y)$，想要得到其中一个变量（比如 $X$）的分布，只需要把另一个变量 $Y$ 的取值范围“推向极限”即可。这就好比我们在看一个二维表格，只想看“总计”那一栏。

对于二维随机变量 $(X, Y)$，**边缘分布函数**定义为：
$$F_X(x) = P(X \le x) = P(X \le x, Y < +\infty) = \lim_{y \to +\infty} F(x, y)$$
同理：
$$F_Y(y) = P(Y \le y) = \lim_{x \to +\infty} F(x, y)$$

**2. 表达式记法**
* $F_X(x) = F(x, +\infty)$
* $F_Y(y) = F(+\infty, y)$



### 3.2.2 边缘分布列 (Marginal PMF - Discrete)

**1. 定义**
对于离散型随机变量，边缘分布律就是把联合概率表格中的某一行或某一列**加和**。

**2. 表达式**
$$P(X=x_i) = p_{i\cdot} = \sum_{j} P(X=x_i, Y=y_j) = \sum_{j} p_{ij}$$
$$P(Y=y_j) = p_{\cdot j} = \sum_{i} P(X=x_i, Y=y_j) = \sum_{i} p_{ij}$$

**3. 举例：宏观经济与违约率**
假设宏观经济（$X$）好坏与某债券违约（$Y$）的联合概率如下：

| $X$(经济) \ $Y$(违约) | 违约 ($Y=1$) | 不违约 ($Y=0$) | **边缘分布 $P(X)$** |
| :--- | :--- | :--- | :--- |
| **衰退 ($X=0$)** | 0.10 | 0.20 | **0.30** |
| **繁荣 ($X=1$)** | 0.05 | 0.65 | **0.70** |
| **边缘分布 $P(Y)$** | **0.15** | **0.85** | **1.00** |

* **解读**：
    * 无论债券是否违约，经济衰退的总概率是 0.30。
    * 无论经济如何，该债券违约的总概率是 0.15。



### 3.2.3 边缘密度函数 (Marginal PDF - Continuous)

这是考研和面试中**计算题的深坑**。

**1. 定义与表达式**
对于连续型随机变量，边缘概率密度函数 $f_X(x)$ 是将联合密度 $f(x, y)$ 关于另一个变量 $y$ 在其**全定义域**上积分。

$$f_X(x) = \int_{-\infty}^{+\infty} f(x, y) \, dy$$
$$f_Y(y) = \int_{-\infty}^{+\infty} f(x, y) \, dx$$

**2. 几何意义**

想象一个 3D 的地形图（联合密度曲面）。光线平行于 $y$ 轴照射过来，曲面在 $xOz$ 平面上的投影（归一化后）就是 $f_X(x)$。这相当于把 $y$ 维度的所有概率质量“挤压”到了 $x$ 轴上。

**3. 计算陷阱：积分限 (The Integration Limits Trap)**
在实际题目中，$f(x, y)$ 往往不是定义在矩形区域，而是三角形或圆形区域。**定积分上下限是解题的关键。**

* **经典例题**：设 $(X, Y)$ 在三角形区域 $D = \{(x, y) | 0 < x < 1, 0 < y < x\}$ 上服从均匀分布。求边缘密度 $f_X(x)$ 和 $f_Y(y)$。
* **解法思路**：
    1.  **画图**：区域是 $y=x$ 直线下方、x轴上方、x=1 左侧的三角形。面积为 $1/2$。
    2.  **联合密度**：$f(x, y) = 2$ （在区域内），0 （其他）。
    3.  **求 $f_X(x)$**：
        * 固定 $x$（画一条垂直线），看 $y$ 的范围。
        * $y$ 从 $0$ 变到 $x$。
        * $$f_X(x) = \int_0^x 2 \, dy = 2y \Big|_0^x = 2x, \quad (0 < x < 1)$$
    4.  **求 $f_Y(y)$**：
        * 固定 $y$（画一条水平线），看 $x$ 的范围。
        * $x$ 从 $y$ 变到 $1$（注意不是到 $x$！）。
        * $$f_Y(y) = \int_y^1 2 \, dx = 2x \Big|_y^1 = 2(1-y), \quad (0 < y < 1)$$



### 3.2.4 随机变量间的独立性 (Independence)

**1. 定义**
如果 $X$ 的取值情况完全不影响 $Y$ 的取值概率，则称 $X$ 和 $Y$ **相互独立**。
* **数学定义**：对于任意实数 $x, y$，都有：
    $$F(x, y) = F_X(x) F_Y(y)$$

**2. 判定条件 (充要条件)**
* **离散型**：对于所有 $i, j$，都有 $P(X=x_i, Y=y_j) = P(X=x_i) P(Y=y_j)$。
* **连续型**：对于几乎所有 $x, y$，都有 $f(x, y) = f_X(x) f_Y(y)$。
    * **正态分布特例**：对于二元正态分布，**独立 $\Leftrightarrow$ 不相关 ($\rho = 0$)**。这是正态分布独有的优美性质，其他分布不一定成立。

**3. 因子分解定理 (Factorization Theorem) —— 快速判定技巧**
如果联合密度函数可以写成两个函数的乘积：
$$f(x, y) = g(x) h(y)$$
并且**定义域必须是矩形区域**（即 $a < x < b, c < y < d$，变量之间在范围上没有约束），那么 $X$ 和 $Y$ 独立。

> **⚠️ 陷阱**
> 考虑 $f(x, y) = 8xy, \quad 0 < x < y < 1$。
> * **误区**：$8xy$ 可以拆成 $8x \cdot y$，所以独立？
> * **正解**：**不独立**！因为定义域 $0 < x < y < 1$ 是一个三角形。$x$ 的取值限制了 $y$ 的取值（例如若 $x=0.9$，则 $y$ 只能在 $0.9 \sim 1$ 之间）。只要定义域不是矩形（即变量间有耦合约束），一定不独立。

**4. 独立随机变量的和 (Convolution)**
量化中常需要计算两个独立信号叠加后的分布。若 $Z = X + Y$，且 $X, Y$ 独立：
* **卷积公式**：
    $$f_Z(z) = \int_{-\infty}^{+\infty} f_X(x) f_Y(z-x) \, dx$$
* **常见可加性**：
    * $X \sim N(\mu_1, \sigma_1^2), Y \sim N(\mu_2, \sigma_2^2) \implies X+Y \sim N(\mu_1+\mu_2, \sigma_1^2+\sigma_2^2)$
    * $X \sim P(\lambda_1), Y \sim P(\lambda_2) \implies X+Y \sim P(\lambda_1+\lambda_2)$
    * $X \sim \chi^2(n), Y \sim \chi^2(m) \implies X+Y \sim \chi^2(n+m)$
